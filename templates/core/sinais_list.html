{% extends "core/base.html" %}
{% block title %}Sinais Vitais - ILPI{% endblock %}

{% block content %}
<form method="get" class="d-flex gap-2 mb-3">
  <input type="date" name="ini" class="form-control">
  <input type="date" name="fim" class="form-control">

  <button formaction="{% url 'sinais_pdf' %}" class="btn btn-primary">
    ðŸ“„ PDF
  </button>

  <button formaction="{% url 'sinais_csv' %}" class="btn btn-outline-secondary">
    ðŸ“Š Excel
  </button>
</form>


<div class="page-title">
  <h1>Sinais Vitais</h1>
  <div style="display:flex; gap:10px;">
    <a class="btn btn-ghost" href="/sinais/pdf/?{{ request.GET.urlencode }}">Exportar PDF</a>
    <a class="btn btn-primary" href="{% url 'sinal_create' %}">âž• Novo Registro</a>

  </div>
</div>

<div class="card" style="margin-bottom:12px;">
  <form method="get" class="grid" style="align-items:end;">
    <div class="col-6">
      <label>Paciente</label>
      <select name="paciente" class="input">
        <option value="">Todos</option>
        {% for p in pacientes %}
          <option value="{{ p.id }}" {% if paciente_id == p.id|stringformat:"s" %}selected{% endif %}>
            {{ p.nome }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-3">
      <label>Data inÃ­cio</label>
      <input class="input" type="date" name="inicio" value="{{ inicio }}">
    </div>

    <div class="col-3">
      <label>Data fim</label>
      <input class="input" type="date" name="fim" value="{{ fim }}">
    </div>

    <div class="col-12" style="display:flex; gap:10px;">
      <button class="btn btn-primary" type="submit">Aplicar filtros</button>
      <a class="btn btn-ghost" href="/sinais/">Limpar</a>
    </div>
  </form>
</div>

<div class="grid" style="margin-bottom:12px;">
  <div class="col-3"><div class="stat"><div class="label">Total filtrado</div><div class="value">{{ total }}</div></div></div>
  <div class="col-3"><div class="stat"><div class="label">Temperatura mÃ©dia</div><div class="value">{{ media_temp }}</div></div></div>
  <div class="col-3"><div class="stat"><div class="label">FC mÃ©dia</div><div class="value">{{ media_fc }}</div></div></div>
</div>

<div class="table-responsive">
  <table class="table table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th>Paciente</th>
        <th>Data/Hora</th>
        <th>Temp</th>
        <th>Sat Oâ‚‚</th>
        <th>Dextro</th>
        <th>PA</th>
        <th>FC</th>
      </tr>
    </thead>

    <tbody>
      {% for s in sinais %}
        <tr>
          <td>{{ s.paciente.nome }}</td>
          <td>{{ s.data_hora|date:"d/m/Y H:i" }}</td>

          <td>{% if s.temperatura != None %}{{ s.temperatura }}{% else %}â€”{% endif %}</td>
          <td>{% if s.saturacao_oxigenio != None %}{{ s.saturacao_oxigenio }}{% else %}â€”{% endif %}</td>
          <td>{% if s.glicemia != None %}{{ s.glicemia }}{% else %}â€”{% endif %}</td>

          <td>{{ s.pressao_arterial|default:"â€”" }}</td>
          <td>{% if s.frequencia_cardiaca != None %}{{ s.frequencia_cardiaca }}{% else %}â€”{% endif %}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7" class="text-muted">Sem sinais vitais.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
