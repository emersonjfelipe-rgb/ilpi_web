{% extends "core/base.html" %}
{% block title %}Estoque - {{ paciente.nome }}{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="mb-0">Estoque do paciente</h2>
    <small class="text-muted">{{ paciente.nome }}</small>
  </div>

  <div class="d-flex gap-2">
    <a class="btn btn-primary" href="{% url 'estoque_item_create' paciente.id %}">âž• Adicionar item</a>
    <a class="btn btn-outline-secondary" href="{% url 'estoque_list' %}">â¬… Voltar</a>
  </div>
</div>

{% if low_items %}
<div class="alert alert-danger">
  <b>âš  Estoque baixo neste paciente</b>
  <ul class="mb-0">
    {% for i in low_items %}
      <li>{{ i.produto.nome }}: <b>{{ i.quantidade_atual }}</b> (mÃ­n. {{ i.minimo_alerta }})</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<div class="card border-0 shadow-sm" style="border-radius:16px;">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Item</th>
            <th>Qtd atual</th>
            <th>MÃ­nimo</th>
            <th>Consumo diÃ¡rio</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          {% for i in items %}
          <tr>
            <td>{% if i.produto.tipo == "MED" %}ðŸ’Š{% else %}ðŸ§·{% endif %} {{ i.produto.get_tipo_display }}</td>
            <td>{{ i.produto.nome }}</td>
            <td><b>{{ i.quantidade_atual }}</b> {{ i.produto.unidade }}</td>
            <td>{{ i.minimo_alerta }}</td>
            <td>
              {% if i.produto.tipo == "FRA" %}
                {{ i.consumo_diario|default:"â€”" }}
              {% else %}
                â€”
              {% endif %}
            </td>
            <td>
              {% if i.baixo %}
                <span class="badge bg-danger">Baixo</span>
              {% else %}
                <span class="badge bg-success">OK</span>
              {% endif %}
            </td>
            <td>
              <a class="btn btn-sm btn-outline-success" href="{% url 'estoque_entrada' i.id %}">ðŸ“¦ Entrada</a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="7">Nenhum item cadastrado para este paciente.</td></tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>
</div>

{% endblock %}
